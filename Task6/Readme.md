

### **ДЗ 7: Работа с загрузчиком**

Инструкция проверена на связке: хостовая ОС Ubuntu 24.04, VirtualBox v7.0.18 и гостевая ОС Ubuntu 22.04.

---

### **1. Включение отображения меню GRUB**

По умолчанию меню загрузчика GRUB скрыто. Для его отображения необходимо изменить конфигурацию.

**Шаги:**
1.  Откройте конфигурационный файл GRUB с правами root:
    ```
    sudo nano /etc/default/grub
    ```

2.  Внесите следующие изменения:
    *   **Закомментируйте** строку, скрывающую меню.
    *   **Установите** таймаут (в секундах) для отображения меню.
    ```
    #GRUB_TIMEOUT_STYLE=hidden
    GRUB_TIMEOUT=10
    ```

3.  Сохраните файл и примените новую конфигурацию:
    ```
    sudo update-grub
    ```

4.  Перезагрузите систему для проверки:
    ```
    sudo reboot
    ```
**Результат:** При следующей загрузке вы увидите меню GRUB в течение 10 секунд.

---

### **2. Попадание в систему без пароля**

Рассмотрим два способа получения root-доступа через загрузчик.

#### **Способ 1: Однопользовательский режим через `init=/bin/`**

1.  В меню GRUB выделите нужную строку и нажмите клавишу `e` для редактирования параметров загрузки.
2.  Найдите строку, начинающуюся с `linux`. В **конце** этой строки добавьте `init=/bin/`.
    *   *Пример:* `... ro quiet splash $vt_handoff init=/bin/`
3.  Для загрузки с измененными параметрами нажмите `Ctrl+X` (или `F10`).

**Результат:** Вы попадете в командную оболочку с правами root.

**Важный нюанс:** Файловая система смонтирована в режиме "только для чтения" (Read-Only). Чтобы получить возможность вносить изменения, перемонтируйте корневой раздел:
```
mount -o remount,rw /
```
**Проверка:** Убедитесь, что операция прошла успешно:
```
mount | grep " / "
```
Вывод должен содержать `rw`.

#### **Способ 2: Режим восстановления (Recovery Mode)**

1.  В меню GRUB выберите пункт **"Advanced options for Ubuntu"**.
2.  Затем выберите строку с пометкой **"(recovery mode)"** и нажмите `Enter`.
3.  Вы окажетесь в меню Recovery Mode. С помощью клавиш со стрелками выберите пункт **"root"** (Drop to root shell prompt) и нажмите `Enter`.

**Результат:** Вы попадете в консоль с правами root. В этом режиме корневая файловая система уже смонтирована в режиме чтения и записи.

**Примечание:** Если вы ранее задавали пароль для пользователя root, система попросит его ввести.

---

### **3. Установка системы с LVM и переименование Volume Group (VG)**

#### **Установка**
При установке Ubuntu выберите опцию **"Use LVM with the new Ubuntu installation"**. Установщик автоматически создаст Volume Group (обычно с именем `ubuntu-vg`).

#### **Переименование VG**

1.  **Проверьте текущее состояние LVM:**
    ```
    sudo vgs
    ```
    **Пример вывода:**
    ```
    VG        #PV #LV #SN Attr   VSize  VFree
    ubuntu-vg   1   1   0 wz--n- 18.22g 8.22g
    ```

2.  **Переименуйте Volume Group.** Команда `vgrename` требует прав root.
    ```
    sudo vgrename ubuntu-vg ubuntu-otus
    ```
    **Ожидаемый результат:**
    ```
    Volume group "ubuntu-vg" successfully renamed to "ubuntu-otus"
    ```

3.  **Обновите конфигурацию загрузчика.**
    *   Обновите `initramfs`:
        ```
        sudo update-initramfs -c -k all
        ```
    *   Обновите конфигурацию GRUB:
        ```
        sudo update-grub
        ```

4.  **Внимание! Критический шаг.** Отредактируйте файл конфигурации GRUB, чтобы он знал о новом имени VG. В файле `/boot/grub/grub.cfg` старое имя VG (в котором дефис заменен на два дефиса) нужно заменить на новое.
    *   *Пример замены:* `ubuntu--vg` -> `ubuntu--otus`

    > **Важно:** Будьте осторожны при редактировании `grub.cfg`, так как его повреждение может сделать систему не загружаемой. Рекомендуется создать резервную копию перед редактированием.

5.  **Перезагрузите систему и проверьте результат:**
    ```
    sudo reboot
    ```
    После загрузки убедитесь, что переименование прошло успешно:
    ```
    sudo vgs
    ```
    **Ожидаемый вывод:**
    ```
    VG           #PV #LV #SN Attr   VSize  VFree
    ubuntu-otus   1   1   0 wz--n- 18.22g 8.22g
    ```

#### **Дополнительно: Переименование Logical Volume (LV)**

При желании можно также переименовать Logical Volume внутри новой VG.
1.  Посмотрите список LV:
    ```
    sudo lvs
    ```
2.  Переименуйте LV (например, `ubuntu-lv` в `ubuntu-otus-lv`):
    ```
    sudo lvrename ubuntu-otus ubuntu-lv ubuntu-otus-lv
    ```
3.  После этого также необходимо обновить `initramfs` и `grub`, как показано в шагах выше, и внести соответствующие правки в `/etc/fstab` (если там используется имя LV).
